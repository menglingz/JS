<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <style>
    @charset "utf-8";

    * {
      margin: 0;
      padding: 0;
      list-style-type: none;
    }

    a {
      color: #666;
      text-decoration: none;
    }

    table {
      border-collapse: collapse;
      border-spacing: 0;
      border: 0;
    }

    body {
      color: #666;
      font-size: 12px;
    }

    clearfix:after {
      content: ".";
      display: block;
      height: 0;
      clear: both;
      visibility: hidden
    }

    .clearfix {
      display: inline-table
    }

    *html .clearfix {
      height: 1%
    }

    .clearfix {
      display: block
    }

    *+html .clearfix {
      min-height: 1%
    }

    .fl {
      float: left;
    }

    .fr {
      float: right;
    }

    .catbox {
      width: 940px;
      margin: 100px auto;
    }

    .catbox table {
      text-align: center;
      width: 100%;
    }

    .catbox table th,
    .catbox table td {
      border: 1px solid ;
    }

    .catbox table th {
      height: 30px;
    }

    .catbox table td {
      padding: 10px;
      color: #444;
    }

    .catbox table tbody tr:hover {
      background: RGB(238, 246, 255);
    }

    .checkbox {
      width: 60px;
    }

    .check-all {
      vertical-align: middle;
    }

    .goods {
      width: 300px;
    }

    .goods span {
      width: 180px;
      margin-top: 20px;
      text-align: left;
      float: left;
    }

    .goods img {
      width: 100px;
      height: 80px;
      margin-right: 10px;
      float: left;
    }

    .price {
      width: 130px;
    }

    .count {
      width: 90px;
    }

    .count .add,
    .count input,
    .count .reduce {
      float: left;
      margin-right: -1px;
      position: relative;
      z-index: 0;
    }

    .count .add,
    .count .reduce {
      height: 23px;
      width: 17px;
      border: 1px solid #e5e5e5;
      background: #f0f0f0;
      text-align: center;
      line-height: 23px;
      color: #444;
    }

    .count .add:hover,
    .count .reduce:hover {
      color: #f50;
      z-index: 3;
      border-color: #f60;
      cursor: pointer;
    }

    .count input {
      width: 50px;
      height: 15px;
      line-height: 15px;
      border: 1px solid #aaa;
      color: #343434;
      text-align: center;
      padding: 4px 0;
      background-color: #fff;
      z-index: 2;
    }

    .subtotal {
      width: 150px;
      color: red;
      font-weight: bold;
    }

    .operation span:hover,
    a:hover {
      cursor: pointer;
      color: red;
      text-decoration: underline;
    }

    .foot {
      margin-top: 0px;
      color: #666;
      height: 48px;
      border: 1px solid #c8c8c8;
      border-top: 0;
      background-color: #eaeaea;
      background-image: linear-gradient(RGB(241, 241, 241), RGB(226, 226, 226));
      position: relative;
      z-index: 8;
    }

    .foot div,
    .foot a {
      line-height: 48px;
      height: 48px;
    }

    .foot .select-all {
      width: 80px;
      height: 48px;
      line-height: 48px;
      color: #666;
      text-align: center;
    }

    .foot .delete {
      padding-left: 10px;
    }

    .foot .closing {
      border-left: 1px solid #c8c8c8;
      width: 103px;
      text-align: center;
      color: #666;
      font-weight: bold;
      cursor: pointer;
      background-image: linear-gradient(RGB(241, 241, 241), RGB(226, 226, 226));
    }

    .foot .closing:hover {
      background-image: linear-gradient(RGB(226, 226, 226), RGB(241, 241, 241));
      color: #333;
    }

    .foot .total {
      margin: 0 20px;
      cursor: pointer;
    }

    .foot #priceTotal,
    .foot #selectedTotal {
      color: red;
      font-weight: bold;
    }

    .foot .selected {
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="catbox">
    <table id="cartTable">
      <thead>
        <tr>
          <th>
            <input class="check-all check" type="checkbox" />&nbsp;&nbsp;全选
          </th>
          <th>商品</th>
          <th>单价</th>
          <th>数量</th>
          <th>小计</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="checkbox">
            <input class="check-one check" type="checkbox" />
          </td>
          <td class="goods">
            <img src="../img/miWatch.jpg" alt="" />
            <span>aa</span>
          </td>
          <td class="price">5999.88</td>
          <td class="count">
            <span class="reduce"></span>
            <input class="count-input" type="text" value="1" />
            <span class="add">+</span>
          </td>
          <td class="subtotal">5999.88</td>
          <td class="operation">
            <span class="delete">删除</span>
          </td>
        </tr>
        <tr>
          <td class="checkbox">
            <input class="check-one check" type="checkbox" />
          </td>
          <td class="goods">
            <img src="../img/miWatch.jpg" alt="" />
            <span>aa</span>
          </td>
          <td class="price">3888.50</td>
          <td class="count">
            <span class="reduce"></span>
            <input class="count-input" type="text" value="1" />
            <span class="add">+</span>
          </td>
          <td class="subtotal">3888.50</td>
          <td class="operation">
            <span class="delete">删除</span>
          </td>
        </tr>
        <tr>
          <td class="checkbox">
            <input class="check-one check" type="checkbox" />
          </td>
          <td class="goods">
            <img src="../img/miWatch.jpg" alt="" />
            <span>aa</span>
          </td>
          <td class="price">1428.50</td>
          <td class="count">
            <span class="reduce"></span>
            <input class="count-input" type="text" value="1" />
            <span class="add">+</span>
          </td>
          <td class="subtotal">1428.50</td>
          <td class="operation">
            <span class="delete">删除</span>
          </td>
        </tr>
        <tr>
          <td class="checkbox">
            <input class="check-one check" type="checkbox" />
          </td>
          <td class="goods">
            <img src="../img/miWatch.jpg" alt="" />
            <span>aa</span>
          </td>
          <td class="price">640.60</td>
          <td class="count">
            <span class="reduce"></span>
            <input class="count-input" type="text" value="1" />
            <span class="add">+</span>
          </td>
          <td class="subtotal">640.60</td>
          <td class="operation">
            <span class="delete">删除</span>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="foot" id="foot">
      <label class="fl select-all">
        <input type="checkbox" class="check-all check" />&nbsp;&nbsp;全选</label>
      <a class="fl delete" id="deleteAll" href="javascript:;">删除</a>
      <div class="fr closing" onclick="getTotal();">结 算</div>
      <div class="fr total">合计：￥<span id="priceTotal">0.00</span></div>
      <div class="fr selected" id="selected">已选商品
        <span id="selectedTotal">0</span>件
      </div>
    </div>
    <script>
      // 获取元素
      const table = document.querySelector('#cartTable'); // 购物车表格
      const selectInputs = document.querySelectorAll('.check'); // 所有勾选框
      const selectOneInputs = Array.from(document.querySelectorAll('.check-one')) // 单选
      const checkAllInputs = document.querySelectorAll('.check-all') // 全选框
      const tr = table.children[1].rows; // 每一行
      const selectedTotal = document.querySelector('#selectedTotal'); //已选商品数目容器
      const priceTotal = document.querySelector('#priceTotal'); //总计
      const deleteAll = document.querySelector('#deleteAll'); // 删除全部按钮
      const selected = document.querySelector('#selected'); //已选商品
      // 点击选择框
      for (let i = 0; i < selectInputs.length; i++) {
        selectInputs[i].addEventListener('click', function () {
          // 类名中有check-all是全选按钮
          if (this.className.indexOf('check-all') >= 0) {
            for (let j = 0; j < selectInputs.length; j++) {
              selectInputs[j].checked = this.checked;
            }
          }
          //只要有一个未勾选，则取消全选框的选中状态
          if (!this.checked) {
            for (let i = 0; i < checkAllInputs.length; i++) {
              checkAllInputs[i].checked = false;
            }
          }
          // 当所有check-one选中之后，check-all的选中状态为true
          let allState = selectOneInputs.every(function (item) {
            return item.checked === true
          })
          if (allState) {
            for (let i = 0; i < checkAllInputs.length; i++) {
              checkAllInputs[i].checked = allState
            }
          }
          //选完更新总计
          getTotal();
        })
      }
      // 计算商品总数和价格
      function getTotal() {
        var seleted = 0;
        var price = 0;
        for (let i = 0; i < tr.length; i++) {
          // 判断当前行的选中按钮是否选中
          if (tr[i].getElementsByTagName('input')[0].checked) {
            // 选中商品数量相加
            seleted += parseInt(tr[i].getElementsByTagName('input')[1].value);
            // 选中商品价格相加
            price += parseFloat(tr[i].cells[4].innerHTML);
          }
        }
        selectedTotal.innerHTML = seleted;
        priceTotal.innerHTML = price.toFixed(2);
      }
      // 计算单行价格
      function getSubtotal(tr) {
        // cells 集合返回表格行中所有 <td> 或 <th> 元素的个数
        var cells = tr.cells;
        var price = cells[2]; //单价
        var subtotal = cells[4]; //小计
        var countInput = tr.getElementsByTagName('input')[1]; // 商品数量
        var span = tr.getElementsByTagName('span')[1]; //-号
        //写入HTML
        subtotal.innerHTML = (parseInt(countInput.value) * parseFloat(price.innerHTML)).toFixed(2);
        //如果数目只有一个，把-号去掉
        if (countInput.value == 1) {
          span.innerHTML = '';
        } else {
          span.innerHTML = '-';
        }
      }
      //为每行元素添加事件
      for (let i = 0; i < tr.length; i++) {
        //将点击事件绑定到tr元素
        tr[i].addEventListener('click', function (e) {
          var e = e || window.event;
          var el = e.target || e.srcElement; //通过事件对象的target属性获取触发元素
          var cls = el.className; //触发元素的class
          var countInout = this.getElementsByTagName('input')[1]; // 数目input
          var value = parseInt(countInout.value); //数目
          //通过判断触发元素的class确定用户点击了哪个元素
          switch (cls) {
            case 'add': //点击了加号
              countInout.value = value + 1;
              getSubtotal(this);
              break;
            case 'reduce': //点击了减号
              if (value > 1) {
                countInout.value = value - 1;
                getSubtotal(this);
              }
              break;
            case 'delete': //点击了删除
              var conf = confirm('确定删除此商品吗？');
              if (conf) {
                this.parentNode.removeChild(this);
              }
              break;
          }
          getTotal();
        })
        // 给数目输入框绑定keyup事件
        tr[i].getElementsByTagName('input')[1].addEventListener('keyup', function () {
          var val = parseInt(this.value);
          if (isNaN(val) || val <= 0) {
            val = 1;
          }
          if (this.value != val) {
            this.value = val;
          }
          getSubtotal(this.parentNode.parentNode); //更新小计
          getTotal(); //更新总数
        })
      }
      // 点击全部删除
      deleteAll.addEventListener('click',function () {
        if (selectedTotal.innerHTML != 0) {
          var con = confirm('确定删除所选商品吗？'); //弹出确认框
          if (con) {
            for (var i = 0; i < tr.length; i++) {
              // 如果被选中，就删除相应的行
              if (tr[i].getElementsByTagName('input')[0].checked) {
                tr[i].parentNode.removeChild(tr[i]); // 删除相应节点
                i--; 
              }
            }
          }
        } else {
          alert('请选择商品！');
        }
        getTotal(); //更新总数
      }) 
    </script>
</body>

</html>